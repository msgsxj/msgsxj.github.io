<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-fruit.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-fruit.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-fruit.png">
  <link rel="mask-icon" href="/images/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://msgsxj.cn').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="前言:本文主要参考了来自coursera上约翰霍普金斯大学Data Science系列课程Course3:Getting and Cleaning Data.">
<meta property="og:type" content="article">
<meta property="og:title" content="Getting and Cleaning Data">
<meta property="og:url" content="https://msgsxj.cn/2017/12/06/Getting-and-Cleaning-Data/index.html">
<meta property="og:site_name" content="msgsxj&#39;blog">
<meta property="og:description" content="前言:本文主要参考了来自coursera上约翰霍普金斯大学Data Science系列课程Course3:Getting and Cleaning Data.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_XML_1.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_XML_2.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_JSON.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_mysql.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_HDF5.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_me.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_zhouzhihua.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_httr.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_X%5B%5D.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_sort.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_str.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_is.na.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_xtabs.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_sequence.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_logical.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_category.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_factor.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_melt.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_tapply.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_ddply.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_sapply.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_sub.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_grep.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_stringr.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_date.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_lubridate.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_parse_number.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_print%2810%29.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_data.table.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_fread.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_apply.png">
<meta property="og:image" content="https://msgsxj.cn/pictures/R/R_now.png">
<meta property="article:published_time" content="2017-12-06T15:27:46.000Z">
<meta property="article:modified_time" content="2020-01-01T07:47:48.013Z">
<meta property="article:author" content="msgsxj">
<meta property="article:tag" content="R">
<meta property="article:tag" content="get data">
<meta property="article:tag" content="clean data">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://msgsxj.cn/pictures/R/R_XML_1.png">

<link rel="canonical" href="https://msgsxj.cn/2017/12/06/Getting-and-Cleaning-Data/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Getting and Cleaning Data | msgsxj'blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148974741-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-148974741-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1bc9ef392b6302f7b4918f79882fbe82";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">msgsxj'blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://msgsxj.cn/2017/12/06/Getting-and-Cleaning-Data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="msgsxj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="msgsxj'blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Getting and Cleaning Data
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-06 23:27:46" itemprop="dateCreated datePublished" datetime="2017-12-06T23:27:46+08:00">2017-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-01 15:47:48" itemprop="dateModified" datetime="2020-01-01T15:47:48+08:00">2020-01-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>前言:本文主要参考了来自coursera上约翰霍普金斯大学Data Science系列课程Course3:Getting and Cleaning Data.</p>
<span id="more"></span>
<hr />
<h1 id="tips">Tips</h1>
<ul>
<li>记录你的每一步操作</li>
<li>变量名应当取得比较详尽,不要缩写</li>
<li>善用??</li>
</ul>
<hr />
<h1 id="data-collection">Data collection</h1>
<h2 id="set-path">set path</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="create-directories">create directories</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!file.exists(<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">	dir.create(<span class="string">&quot;data&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="get-data">get data</h2>
<h3 id="from-csv">from csv</h3>
<ul>
<li>utils包中函数:</li>
<li>download.file():如果是https开头,mac需要指定method = "curl",win不需要;如果是http开头则都不需要</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br><span class="line">fileurl &lt;- <span class="string">&quot;https://data.baltimorecity.gov/api/views/dz54-2aru/rows.csv?accseeType=DOWNLOAD&quot;</span></span><br><span class="line">download.file(fileurl, destfile = <span class="string">&quot;./data/cameras.csv&quot;</span>, method = <span class="string">&quot;curl&quot;</span>) <span class="comment"># mac需要指定curl,win不需要</span></span><br><span class="line">list.files(<span class="string">&quot;./data&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>utils包中函数:</li>
<li>read.table()</li>
<li>read.csv()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cameraData &lt;- read.table(<span class="string">&quot;./data/cameras.csv&quot;</span>, sep = <span class="string">&quot;,&quot;</span>, header = <span class="literal">TRUE</span>)</span><br><span class="line">cameraData &lt;- read.csv(<span class="string">&quot;./data/cameras.csv&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>重复读取1000次,两种方式读取csv所花时间对比</li>
<li>read.table():1.862808 secs</li>
<li>read.csv():1.861519 secs</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">t1 &lt;- Sys.time()</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>)&#123;</span><br><span class="line">  cameraData &lt;- read.table(<span class="string">&quot;./data/cameras.csv&quot;</span>, sep = <span class="string">&quot;,&quot;</span>, header = <span class="literal">TRUE</span>)</span><br><span class="line">&#125;</span><br><span class="line">Sys.time() - t1 <span class="comment"># 1.862808 secs</span></span><br><span class="line"></span><br><span class="line">t2 &lt;- Sys.time()</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">1000</span>)&#123;</span><br><span class="line">  cameraData &lt;- read.csv(<span class="string">&quot;./data/cameras.csv&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">Sys.time() - t2 <span class="comment"># 1.861519 secs</span></span><br></pre></td></tr></table></figure>
<h3 id="from-xlsx">from xlsx</h3>
<ul>
<li>首先用excel手动将cameras.csv转存为cameras.xlsx</li>
<li><a target="_blank" rel="noopener" href="https://github.com/tidyverse/readxl">readxl</a>包中函数:</li>
<li>read_excel()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br><span class="line">install.packages(<span class="string">&quot;tidyverse&quot;</span>)</span><br><span class="line">install.packages(<span class="string">&quot;readxl&quot;</span>)</span><br><span class="line">library(readxl)</span><br><span class="line">cameraData &lt;- read_excel(<span class="string">&quot;./data/cameras.xlsx&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="from-xml">from xml</h3>
<ul>
<li>XML包中函数:</li>
<li>xmlTreeParse()</li>
<li>xmlRoot()</li>
<li>xmlName()</li>
<li>xmlSApply()</li>
<li>xpathSApply()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">&quot;XML&quot;</span>)</span><br><span class="line">library(XML)</span><br><span class="line">fileurl_1 &lt;- <span class="string">&quot;http://www.w3school.com.cn/example/xmle/note.xml&quot;</span></span><br><span class="line">doc_1 &lt;- xmlTreeParse(fileurl_1, useInternal = <span class="literal">TRUE</span>)</span><br><span class="line">doc_1</span><br><span class="line">rootNode &lt;- xmlRoot(doc_1)</span><br><span class="line">rootNode</span><br><span class="line">xmlName(rootNode)</span><br><span class="line">rootNode[[<span class="number">1</span>]]</span><br><span class="line">rootNode[[<span class="number">1</span>]][[<span class="number">1</span>]]</span><br><span class="line">xmlSApply(rootNode, xmlValue) <span class="comment">#获得所有文本</span></span><br><span class="line">xpathSApply(rootNode, <span class="string">&quot;//to&quot;</span>, xmlValue) <span class="comment">#所有标签为to的文本</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_XML_1.png" /></p>
<ul>
<li>另一个例子</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fileurl_2 &lt;- <span class="string">&quot;http://espn.go.com/nfl/team/_/name/bal/baltimore-ravens&quot;</span></span><br><span class="line">doc_2 &lt;- htmlTreeParse(fileurl_2, useInternal = <span class="literal">TRUE</span>)</span><br><span class="line">time &lt;- xpathSApply(doc_2, <span class="string">&quot;//div[@class=&#x27;game-meta&#x27;]&quot;</span>, xmlValue)</span><br><span class="line">time</span><br><span class="line">team &lt;- xpathSApply(doc_2, <span class="string">&quot;//div[@class=&#x27;game-info&#x27;]&quot;</span>, xmlValue)</span><br><span class="line">team</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_XML_2.png" /></p>
<h3 id="from-json">from JSON</h3>
<ul>
<li>json结构有点类似xml,应用广泛,也是通过API获得的数据的最常见类型</li>
<li>jsonlite包中函数:</li>
<li>fromJSON()</li>
<li>toJSON()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library(jsonlite)</span><br><span class="line">jsonData &lt;- fromJSON(<span class="string">&quot;https://api.github.com/users/jtleek/repos&quot;</span>)</span><br><span class="line"><span class="built_in">names</span>(jsonData)</span><br><span class="line"><span class="built_in">names</span>(jsonData$owner)</span><br><span class="line">jsonData$owner$login</span><br><span class="line">myjson &lt;- toJSON(iris, pretty=<span class="literal">TRUE</span>)</span><br><span class="line">iris2 &lt;- fromJSON(myjson)</span><br><span class="line">head(iris2)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_JSON.png" /></p>
<h3 id="from-mysql">from MySQL</h3>
<ul>
<li>DBI包中函数:</li>
<li>dbConnect()</li>
<li>dbGetQuery()</li>
<li>RMySQL包中函数:</li>
<li>MySQL()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library(DBI)</span><br><span class="line">install.packages(<span class="string">&quot;RMySQL&quot;</span>)</span><br><span class="line">library(RMySQL)</span><br><span class="line">ucscDb &lt;- dbConnect(MySQL(), user = <span class="string">&quot;genome&quot;</span>, host = <span class="string">&quot;genome-mysql.cse.ucsc.edu&quot;</span>)</span><br><span class="line">result &lt;- dbGetQuery(ucscDb, <span class="string">&quot;show databases;&quot;</span>);dbDisconnect(ucscDb); <span class="comment">#断开连接后会返回TRUE</span></span><br></pre></td></tr></table></figure>
<ul>
<li>一个数据库的例子:hg19</li>
<li>DBI包中函数:</li>
<li>dbListTables()</li>
<li>dbReadTable()</li>
<li>dbSendQuery()</li>
<li>fetch()</li>
<li>dbClearResult()</li>
<li>dbDisconnect()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hg19 &lt;- dbConnect(MySQL(), user = <span class="string">&quot;genome&quot;</span>, db = <span class="string">&quot;hg19&quot;</span>, host = <span class="string">&quot;genome-mysql.cse.ucsc.edu&quot;</span>)</span><br><span class="line">allTables &lt;- dbListTables(hg19)</span><br><span class="line"><span class="built_in">length</span>(allTables)</span><br><span class="line">allTables[<span class="number">1</span>:<span class="number">5</span>]</span><br><span class="line">dbListFields(hg19, <span class="string">&quot;affyU133Plus2&quot;</span>)</span><br><span class="line">dbGetQuery(hg19, <span class="string">&quot;select count(*) from affyU133Plus2&quot;</span>) <span class="comment">#计算表中所有记录 58463</span></span><br><span class="line">affyData &lt;- dbReadTable(hg19, <span class="string">&quot;affyU133Plus2&quot;</span>)</span><br><span class="line">affyData[<span class="number">1</span>,]</span><br><span class="line">query &lt;- dbSendQuery(hg19, <span class="string">&quot;select * from affyU133Plus2 where misMatches between 1 and 3&quot;</span>)</span><br><span class="line">affyMis &lt;- fetch(query)</span><br><span class="line">quantile(affyMis$misMatches)</span><br><span class="line">affyMisSmall &lt;- fetch(query, n = <span class="number">10</span>)</span><br><span class="line">dbClearResult(query) <span class="comment">#清空查询后会返回TRUE</span></span><br><span class="line"><span class="built_in">dim</span>(affyMisSmall)</span><br><span class="line">dbDisconnect(hg19)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_mysql.png" /></p>
<h3 id="from-hdf5">from HDF5</h3>
<ul>
<li>官网:https://support.hdfgroup.org/HDF5/</li>
<li>Hierarchical Data Format(层次型数据结构)</li>
<li>rhdf5包中函数:</li>
<li>h5createFile()</li>
<li>h5createGroup()</li>
<li>h5write()</li>
<li>h5ls()</li>
<li>h5read()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br><span class="line">source(<span class="string">&quot;http://bioconductor.org/biocLite.R&quot;</span>)</span><br><span class="line">biocLite(<span class="string">&quot;rhdf5&quot;</span>)</span><br><span class="line">library(rhdf5)</span><br><span class="line">created = h5createFile(<span class="string">&quot;./data/example.h5&quot;</span>)</span><br><span class="line">created</span><br><span class="line">created = h5createGroup(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo&quot;</span>)</span><br><span class="line">created = h5createGroup(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;baa&quot;</span>)</span><br><span class="line">created = h5createGroup(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/foobaa&quot;</span>)</span><br><span class="line">A = matrix(<span class="number">1</span>:<span class="number">10</span>, nr = <span class="number">2</span>, nc = <span class="number">5</span>)</span><br><span class="line">h5write(A, <span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/A&quot;</span>)</span><br><span class="line">B = array(seq(<span class="number">0.1</span>,<span class="number">2.0</span>,by=<span class="number">0.1</span>) ,<span class="built_in">dim</span> = <span class="built_in">c</span>(<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">attr</span>(B, <span class="string">&quot;scale&quot;</span>) &lt;- <span class="string">&quot;liter&quot;</span></span><br><span class="line">h5write(B, <span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/foobaa/B&quot;</span>)</span><br><span class="line">h5ls(<span class="string">&quot;./data/example.h5&quot;</span>)</span><br><span class="line">df = data.frame(<span class="number">1L</span>:<span class="number">5L</span>, seq(<span class="number">0</span>,<span class="number">1</span>,length.out=<span class="number">5</span>), <span class="built_in">c</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>), stringAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line">h5write(df, <span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;df&quot;</span>) <span class="comment"># df直接写进最高群组</span></span><br><span class="line">h5ls(<span class="string">&quot;./data/example.h5&quot;</span>)</span><br><span class="line">readA = h5read(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/A&quot;</span>)</span><br><span class="line">readB = h5read(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/foobaa/B&quot;</span>)</span><br><span class="line">readdf = h5read(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;df&quot;</span>)</span><br><span class="line">readA</span><br><span class="line">h5write(<span class="built_in">c</span>(<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>), <span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/A&quot;</span>, index = <span class="built_in">list</span>(<span class="number">1</span>,<span class="number">1</span>:<span class="number">3</span>))</span><br><span class="line">h5read(<span class="string">&quot;./data/example.h5&quot;</span>, <span class="string">&quot;foo/A&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_HDF5.png" /></p>
<h3 id="from-the-web">from The Web</h3>
<ul>
<li>base包中函数:</li>
<li>url()</li>
<li>readLines()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">con = url(<span class="string">&quot;http://www.msgsxj.cn/about/&quot;</span>)</span><br><span class="line">htmlCode = readLines(con)</span><br><span class="line">close(con)</span><br><span class="line">htmlCode[<span class="number">378</span>:<span class="number">380</span>]</span><br></pre></td></tr></table></figure>
<figure>
<img src="/pictures/R/R_me.png" alt="me" /><figcaption aria-hidden="true">me</figcaption>
</figure>
<ul>
<li>XML包中函数:</li>
<li>htmlTreeParse()</li>
<li>htmlParse()</li>
<li>xpathSApply()</li>
<li>httr包中函数:</li>
<li>GET()</li>
<li>content()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">library(XML)</span><br><span class="line">url &lt;- <span class="string">&quot;http://xueshu.baidu.com/scholarID/CN-BP75S7TJ&quot;</span> <span class="comment"># 周志华</span></span><br><span class="line">html &lt;- htmlTreeParse(url, useInternalNodes = <span class="built_in">T</span>)</span><br><span class="line">xpathSApply(html, <span class="string">&quot;//div[@class=&#x27;res_info&#x27;]&quot;</span>, xmlValue)</span><br><span class="line"><span class="comment"># httr包的等效实现</span></span><br><span class="line">library(httr)</span><br><span class="line">html2 &lt;- GET(url)</span><br><span class="line">content2 &lt;- content(html2, as = <span class="string">&quot;text&quot;</span>)</span><br><span class="line">parsedHtml &lt;- htmlParse(content2, asText = <span class="literal">TRUE</span>)</span><br><span class="line">xpathSApply(parsedHtml, <span class="string">&quot;//div[@class=&#x27;res_info&#x27;]&quot;</span>, xmlValue)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_zhouzhihua.png" /></p>
<ul>
<li>httr包中函数:</li>
<li>GET():websites with passwords</li>
<li>handle()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pg1 = GET(<span class="string">&quot;https://httpbin.org/basic-auth/user/passwd&quot;</span>)</span><br><span class="line">pg1</span><br><span class="line"><span class="built_in">names</span>(pg1)</span><br><span class="line">pg2 = GET(<span class="string">&quot;https://httpbin.org/basic-auth/user/passwd&quot;</span>, authenticate(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;passwd&quot;</span>))</span><br><span class="line">pg2</span><br><span class="line"><span class="built_in">names</span>(pg2)</span><br><span class="line">baidu = handle(<span class="string">&quot;https://baidu.com&quot;</span>)</span><br><span class="line">pg3 = GET(handle = baidu, path = <span class="string">&quot;/&quot;</span>)</span><br><span class="line">pg3</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_httr.png" /></p>
<h3 id="from-api">from API</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/r-lib/httr/blob/master/demo/oauth2-github.r"></a></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">library(httr)</span><br><span class="line"><span class="comment"># 1. Find OAuth settings for github:</span></span><br><span class="line"><span class="comment">#    http://developer.github.com/v3/oauth/</span></span><br><span class="line">oauth_endpoints(<span class="string">&quot;github&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. To make your own application, register at</span></span><br><span class="line"><span class="comment">#    https://github.com/settings/developers. Use any URL for the homepage URL</span></span><br><span class="line"><span class="comment">#    (http://github.com is fine) and  http://localhost:1410 as the callback url</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Replace your key and secret below.</span></span><br><span class="line">myapp &lt;- oauth_app(<span class="string">&quot;github&quot;</span>,</span><br><span class="line">  key = <span class="string">&quot;56b637a5baffac62cad9&quot;</span>,</span><br><span class="line">  secret = <span class="string">&quot;8e107541ae1791259e9987d544ca568633da2ebf&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Get OAuth credentials</span></span><br><span class="line">github_token &lt;- oauth2.0_token(oauth_endpoints(<span class="string">&quot;github&quot;</span>), myapp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Use API</span></span><br><span class="line">gtoken &lt;- config(token = github_token)</span><br><span class="line">req &lt;- GET(<span class="string">&quot;https://api.github.com/rate_limit&quot;</span>, gtoken)</span><br><span class="line">stop_for_status(req)</span><br><span class="line">content(req)</span><br><span class="line"><span class="comment"># OR:</span></span><br><span class="line">req &lt;- with_config(gtoken, GET(<span class="string">&quot;https://api.github.com/rate_limit&quot;</span>))</span><br><span class="line">stop_for_status(req)</span><br><span class="line">content(req)</span><br></pre></td></tr></table></figure>
<h3 id="from-other-sources">from other sources</h3>
<ul>
<li>下列函数或包自行查询文档:</li>
<li>file()</li>
<li>url()</li>
<li>gzfile()</li>
<li>bzfile()</li>
<li>read.arff()(Weka)</li>
<li>read.dta()(Stata)</li>
<li>read.mtp()(Minitab)</li>
<li>read.octave()(Octave)</li>
<li>read.spss()(SPSS)</li>
<li>read.xport()(SAS)</li>
<li>read_fwf(.for)</li>
<li>RPostresSQL包(provide a DBI-compliant(兼容数据库接口)的数据库连接)</li>
<li>RODBC包(为PostgreQL,MySQL,Microsoft Accsee SQLite提供接口)</li>
<li>RMongo包,rmongodb包(MongoDB)</li>
<li>jpeg(),readbitmap(),png(),EBImage包(读取图像数据)</li>
<li>rdgal包,rgeos包,raster包(读取GIS(Geographic Information System)数据)</li>
<li>tuneR包,seewave包(读取MP3)</li>
</ul>
<h2 id="some-data-resources">Some Data Resources</h2>
<ul>
<li>United Bations:http://data.un.org/</li>
<li>U.S.:http://www.data.gov/</li>
<li>United Kingdom:http://data.gov.uk/</li>
<li>France http://www.data.gouv.fr/</li>
<li>Ghana:http://data.gov.gh/</li>
<li>Australia:http://data.gov.au/</li>
<li>Grenamy:http://www.govdata.de/</li>
<li>Hong Kong:http://www.gov.hk/en/theme/psi/datasets/</li>
<li>Janpan:http://www.data.go.jp/</li>
<li>Many more:http://www.data.gov/opendatasites</li>
<li>http://www.gapminder.org/</li>
<li>http://www.asdfree.com/</li>
<li>http://www.kaggle.com/</li>
<li>Hilary Mason:http://bitly.com/bundles/hmason/1</li>
<li>Jeff Hammerbacher:http://www.quora.com/Jeff-Hammerbacher/Introduction-to-Data-Science-Data-Sets</li>
</ul>
<hr />
<h1 id="making-data-tidy">Making data tidy</h1>
<h2 id="subsetting-and-sorting">Subsetting and Sorting</h2>
<h3 id="subsetting">Subsetting</h3>
<ul>
<li>X[]</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">13435</span>)</span><br><span class="line">X &lt;- data.frame(<span class="string">&quot;var1&quot;</span>=sample(<span class="number">1</span>:<span class="number">5</span>),<span class="string">&quot;var2&quot;</span>=sample(<span class="number">6</span>:<span class="number">10</span>),<span class="string">&quot;var3&quot;</span>=sample(<span class="number">11</span>:<span class="number">15</span>))</span><br><span class="line">X &lt;- X[sample(<span class="number">1</span>:<span class="number">5</span>),]</span><br><span class="line">X$var2[<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">3</span>)]=<span class="literal">NA</span></span><br><span class="line">X</span><br><span class="line">X[,<span class="number">1</span>] <span class="comment">#提取第一列数据</span></span><br><span class="line">X[,<span class="string">&quot;var1&quot;</span>] <span class="comment">#提取var1数据</span></span><br><span class="line">X[<span class="number">1</span>:<span class="number">2</span>,<span class="string">&quot;var2&quot;</span>]</span><br><span class="line">X[(X$var1 &lt;= <span class="number">3</span> &amp; X$var3 &gt; <span class="number">11</span>),]</span><br><span class="line">X[(X$var1 &lt;= <span class="number">3</span> | X$var3 &gt; <span class="number">15</span>),]</span><br><span class="line">X[which(X$var2 &gt; <span class="number">8</span>),]</span><br><span class="line">X[(X$var2 &gt; <span class="number">8</span>),] <span class="comment">#会返回NA</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="/pictures/R/R_X%5B%5D.png" alt="X[]" /><figcaption aria-hidden="true">X[]</figcaption>
</figure>
<h3 id="sorting">Sorting</h3>
<ul>
<li>base包中函数:</li>
<li>sort()</li>
<li>order()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">13435</span>)</span><br><span class="line">X &lt;- data.frame(<span class="string">&quot;var1&quot;</span>=sample(<span class="number">1</span>:<span class="number">5</span>),<span class="string">&quot;var2&quot;</span>=sample(<span class="number">6</span>:<span class="number">10</span>),<span class="string">&quot;var3&quot;</span>=sample(<span class="number">11</span>:<span class="number">15</span>))</span><br><span class="line">X &lt;- X[sample(<span class="number">1</span>:<span class="number">5</span>),]</span><br><span class="line">X$var2[<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">3</span>)]=<span class="literal">NA</span></span><br><span class="line">sort(X$var1)</span><br><span class="line">sort(X$var1, decreasing = <span class="literal">TRUE</span>)</span><br><span class="line">sort(X$var2, na.last = <span class="literal">TRUE</span>)</span><br><span class="line">X[order(X$var1),]</span><br><span class="line">X[order(X$var1,X$var3),]</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_sort.png" /></p>
<ul>
<li>plyr包中函数:</li>
<li>arrange()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">library(plyr)</span><br><span class="line">set.seed(<span class="number">13435</span>)</span><br><span class="line">X &lt;- data.frame(<span class="string">&quot;var1&quot;</span>=sample(<span class="number">1</span>:<span class="number">5</span>),<span class="string">&quot;var2&quot;</span>=sample(<span class="number">6</span>:<span class="number">10</span>),<span class="string">&quot;var3&quot;</span>=sample(<span class="number">11</span>:<span class="number">15</span>))</span><br><span class="line">X &lt;- X[sample(<span class="number">1</span>:<span class="number">5</span>),]</span><br><span class="line">X$var2[<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">3</span>)]=<span class="literal">NA</span></span><br><span class="line">arrange(X, var1)</span><br><span class="line">arrange(X, desc(var1))</span><br><span class="line">X$var4 &lt;- rnorm(<span class="number">5</span>)</span><br><span class="line">X</span><br><span class="line">Y &lt;- cbind(X, rnorm(<span class="number">5</span>))</span><br><span class="line">Y</span><br></pre></td></tr></table></figure>
<p>![(/pictures/R/R_pylr.png)</p>
<h2 id="summarizing-data">Summarizing Data</h2>
<ul>
<li>下载数据</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br><span class="line">fileurl &lt;- <span class="string">&quot;https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accseeType=DOWNLOAD&quot;</span></span><br><span class="line">download.file(fileurl, destfile = <span class="string">&quot;./data/restaurants.csv&quot;</span>, method = <span class="string">&quot;curl&quot;</span>)</span><br><span class="line">restData &lt;- read.csv(<span class="string">&quot;./data/restaurants.csv&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>utils包中函数</li>
<li>head()</li>
<li>tail()</li>
<li>str()</li>
<li>base包中函数:</li>
<li>summary()</li>
<li>table()</li>
<li>stats包中函数:</li>
<li>quantile()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">head(restData, n = <span class="number">1</span>)</span><br><span class="line">tail(restData, n = <span class="number">1</span>)</span><br><span class="line">summary(restData)</span><br><span class="line">str(restData) <span class="comment"># 比summary好用</span></span><br><span class="line">quantile(restData$councilDistrict, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">quantile(restData$councilDistrict, probs = <span class="built_in">c</span>(<span class="number">0.5</span>,<span class="number">0.75</span>,<span class="number">0.9</span>))</span><br><span class="line">table(restData$zipCode, useNA =<span class="string">&quot;ifany&quot;</span>) <span class="comment"># useNA =&quot;ifany&quot;为统计NA个数</span></span><br><span class="line">table(restData$councilDistrict, restData$zipCode)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_str.png" /></p>
<ul>
<li>base包中函数:</li>
<li>is.na()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(<span class="built_in">is.na</span>(restData$councilDistrict))</span><br><span class="line"><span class="built_in">any</span>(<span class="built_in">is.na</span>(restData$councilDistrict))</span><br><span class="line"><span class="built_in">all</span>(restData$zipCode &gt; <span class="number">0</span>)</span><br><span class="line">colSums(<span class="built_in">is.na</span>(restData))</span><br><span class="line"><span class="built_in">all</span>(colSums(<span class="built_in">is.na</span>(restData)) == <span class="number">0</span>)</span><br><span class="line">table(restData$zipCode %in% <span class="built_in">c</span>(<span class="string">&quot;21212&quot;</span>))</span><br><span class="line">table(restData$zipCode %in% <span class="built_in">c</span>(<span class="string">&quot;21212&quot;</span>,<span class="string">&quot;21213&quot;</span>))</span><br><span class="line">restData[(restData$zipCode %in% <span class="built_in">c</span>(<span class="string">&quot;21212&quot;</span>,<span class="string">&quot;21213&quot;</span>)),]</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_is.na.png" /></p>
<ul>
<li>base包中函数:</li>
<li>as.data.frame()</li>
<li>stats中函数:</li>
<li>xtabs()</li>
<li>ftable()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data(UCBAdmissions)</span><br><span class="line">DF = as.data.frame(UCBAdmissions)</span><br><span class="line">summary(DF)</span><br><span class="line">xt &lt;- xtabs(Freq ~ Gender + Admit, data = DF)</span><br><span class="line">xt</span><br><span class="line">warpbreaks$replicate &lt;- <span class="built_in">rep</span>(<span class="number">1</span>:<span class="number">9</span>, len = <span class="number">54</span>)</span><br><span class="line">xt &lt;- xtabs(breaks ~., data = warpbreaks)</span><br><span class="line">ftable(xt)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_xtabs.png" /></p>
<ul>
<li>utils包中函数:</li>
<li>object.size()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fakeData = rnorm(<span class="number">1e5</span>)</span><br><span class="line">object.size(fakeData)</span><br><span class="line">print(object.size(fakeData), units = <span class="string">&quot;Mb&quot;</span>) <span class="comment"># 0.8 Mb</span></span><br></pre></td></tr></table></figure>
<h2 id="creating-new-variables">Creating new Variables</h2>
<ul>
<li>下载数据</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br><span class="line">fileurl &lt;- <span class="string">&quot;https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accseeType=DOWNLOAD&quot;</span></span><br><span class="line">download.file(fileurl, destfile = <span class="string">&quot;./data/restaurants.csv&quot;</span>, method = <span class="string">&quot;curl&quot;</span>)</span><br><span class="line">restData &lt;- read.csv(<span class="string">&quot;./data/restaurants.csv&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="create-sequences">Create sequences</h3>
<ul>
<li>base包中函数:</li>
<li>seq()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seq(<span class="number">1</span>, <span class="number">10</span>, by = <span class="number">2</span>) <span class="comment"># 1 3 5 7 9</span></span><br><span class="line">seq(<span class="number">1</span>, <span class="number">10</span>, <span class="built_in">length</span> = <span class="number">3</span>) <span class="comment"># 1.0  5.5 10.0</span></span><br><span class="line"><span class="built_in">c</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">25</span>, <span class="number">100</span>) <span class="comment"># 1 3 8 25 100</span></span><br><span class="line">seq(along = x) <span class="comment"># 1 2 3 4 5</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_sequence.png" /></p>
<h3 id="create-binary-variables">Create binary variables</h3>
<ul>
<li>base包中函数:</li>
<li>ifelse()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">restData$zipWrong &lt;- ifelse(restData$zipCode &lt; <span class="number">0</span>, <span class="built_in">T</span>, <span class="built_in">F</span>)</span><br><span class="line"><span class="built_in">class</span>(restData$zipWrong)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_logical.png" /></p>
<h3 id="create-categorical-variables">Create categorical variables</h3>
<ul>
<li>base包中函数:</li>
<li>cut()</li>
<li>Hmisc包中函数:</li>
<li>cut2()</li>
<li>plyr包中函数:</li>
<li>mutate()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">&quot;Hmisc&quot;</span>)</span><br><span class="line">restData$zipGroups &lt;- cut(restData$zipCode, breaks = quantile(restData$zipCode))</span><br><span class="line">table(restData$zipGroups)</span><br><span class="line"><span class="built_in">class</span>(restData$zipGroups)</span><br><span class="line">library(Hmisc)</span><br><span class="line">restData$zipGroups &lt;- cut2(restData$zipCode, g = <span class="number">4</span>)</span><br><span class="line">table(restData$zipGroups)</span><br><span class="line"><span class="built_in">class</span>(restData$zipGroups)</span><br><span class="line">library(plyr)</span><br><span class="line">restData2 &lt;- mutate(restData, zipGroups = cut2(zipCode, g = <span class="number">4</span>)) <span class="comment"># 新变量加入</span></span><br><span class="line">table(restData2$zipGroups)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_category.png" /></p>
<ul>
<li>base包中函数:</li>
<li>factor()</li>
<li>stats包中函数:</li>
<li>relevel()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">restData$zcf &lt;- factor(restData$zipCode)</span><br><span class="line">restData$zcf[<span class="number">1</span>:<span class="number">10</span>]</span><br><span class="line"><span class="built_in">class</span>(restData$zcf)</span><br><span class="line">yesno &lt;- sample(<span class="built_in">c</span>(<span class="string">&quot;yes&quot;</span>,<span class="string">&quot;no&quot;</span>), size = <span class="number">10</span>, replace = <span class="literal">TRUE</span>)</span><br><span class="line"><span class="built_in">class</span>(yesno)</span><br><span class="line">yesnofac &lt;- factor(yesno, levels = <span class="built_in">c</span>(<span class="string">&quot;yes&quot;</span>,<span class="string">&quot;no&quot;</span>))</span><br><span class="line"><span class="built_in">class</span>(yesnofac)</span><br><span class="line">relevel(yesnofac, ref = <span class="string">&quot;yes&quot;</span>) <span class="comment"># yes 设置为比较低的水平</span></span><br><span class="line"><span class="built_in">as.numeric</span>(yesnofac)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_factor.png" /></p>
<h3 id="common-transforms">Common transforms</h3>
<ul>
<li>abs()</li>
<li>sqrt()</li>
<li>ceiling()</li>
<li>floor()</li>
<li>round(x, digits = n) # 小数点后有效数字</li>
<li>signif(x, digits = n) # 一共有效数字</li>
<li>cos()</li>
<li>log()</li>
<li>log2()</li>
<li>log10()</li>
<li>exp()</li>
</ul>
<h2 id="reshaping-data">Reshaping Data</h2>
<ul>
<li>reshape2包中函数:</li>
<li>melt()</li>
<li>dcast()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">library(reshape2)</span><br><span class="line"><span class="built_in">dim</span>(mtcars)</span><br><span class="line">mtcars$carname &lt;- rownames(mtcars)</span><br><span class="line">carMelt &lt;- melt(mtcars, id = <span class="built_in">c</span>(<span class="string">&quot;carname&quot;</span>,<span class="string">&quot;gear&quot;</span>,<span class="string">&quot;cyl&quot;</span>), measure.vars = <span class="built_in">c</span>(<span class="string">&quot;mpg&quot;</span>,<span class="string">&quot;hp&quot;</span>)) <span class="comment"># 样本量翻倍</span></span><br><span class="line"><span class="built_in">dim</span>(carMelt)</span><br><span class="line">head(carMelt)</span><br><span class="line">tail(carMelt)</span><br><span class="line"><span class="built_in">class</span>(carMelt$variable)</span><br><span class="line">cylData &lt;- dcast(carMelt, cyl ~ variable, mean)</span><br><span class="line">cylData <span class="comment"># 对melt函数中设定的variable按cyl求平均</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_melt.png" /></p>
<ul>
<li>base包中函数:</li>
<li>tapply()</li>
<li>split()</li>
<li>lappy()</li>
<li>unlist()</li>
<li>sapply()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tapply(InsectSprays$count, InsectSprays$spray, <span class="built_in">sum</span>) <span class="comment"># 按杀虫剂种类求和</span></span><br><span class="line">spIns &lt;- split(InsectSprays$count, InsectSprays$spray);spIns</span><br><span class="line">sprCount &lt;- lapply(spIns, <span class="built_in">sum</span>);sprCount <span class="comment"># 按杀虫剂种类求和</span></span><br><span class="line">unlist(sprCount)</span><br><span class="line">sapply(spIns, <span class="built_in">sum</span>) <span class="comment"># sapply为lapply简化版</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_tapply.png" /></p>
<ul>
<li>plyr包中函数:</li>
<li>ddply()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library(plyr)</span><br><span class="line">ddply(InsectSprays, .(spray), summarise, <span class="built_in">sum</span>=<span class="built_in">sum</span>(count))</span><br><span class="line">spraySums &lt;- ddply(InsectSprays, .(spray), summarise, <span class="built_in">sum</span>=ave(count))</span><br><span class="line"><span class="built_in">dim</span>(spraySums)</span><br><span class="line">head(spraySums)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_ddply.png" /></p>
<h2 id="editing-text-variable">Editing Text Variable</h2>
<ul>
<li>下载数据</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setwd(<span class="string">&quot;C:/Users/msgsxj/Desktop/coursera/Getting and Cleaning Data&quot;</span>)</span><br><span class="line">fileurl &lt;- <span class="string">&quot;https://data.baltimorecity.gov/api/views/dz54-2aru/rows.csv?accseeType=DOWNLOAD&quot;</span></span><br><span class="line">download.file(fileurl, destfile = <span class="string">&quot;./data/camera2.csv&quot;</span>, method = <span class="string">&quot;curl&quot;</span>)</span><br><span class="line">camera2Data &lt;- read.csv(<span class="string">&quot;./data/camera2.csv&quot;</span>)</span><br><span class="line"><span class="built_in">names</span>(camera2Data)</span><br></pre></td></tr></table></figure>
<ul>
<li>base包中函数:</li>
<li>tolower()</li>
<li>strsplit()</li>
<li>sapply()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">names</span>(camera2Data) &lt;- tolower(<span class="built_in">names</span>(camera2Data)) <span class="comment"># 变量名全部变小写</span></span><br><span class="line"><span class="built_in">names</span>(camera2Data)</span><br><span class="line">splitNames &lt;- strsplit(<span class="built_in">names</span>(camera2Data),<span class="string">&quot;\\.&quot;</span>) <span class="comment"># split 需转义</span></span><br><span class="line">splitNames[[<span class="number">6</span>]]</span><br><span class="line">splitNames[[<span class="number">6</span>]][<span class="number">1</span>]</span><br><span class="line">firstElement &lt;- <span class="keyword">function</span>(x)&#123;x[<span class="number">1</span>]&#125;</span><br><span class="line"><span class="built_in">names</span>(camera2Data) &lt;- sapply(splitNames,firstElement)  <span class="comment"># 想只保留splitNames[[6]]的第一部分</span></span><br><span class="line"><span class="built_in">names</span>(camera2Data)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_sapply.png" /></p>
<ul>
<li>上述srtsplit()+sapply()过程的相似处理:用""取代"."</li>
<li>sub()</li>
<li>gsub() 替换所有</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">camera2Data &lt;- read.csv(<span class="string">&quot;./data/camera2.csv&quot;</span>) <span class="comment">#重新载入</span></span><br><span class="line"><span class="built_in">names</span>(camera2Data)</span><br><span class="line">sub(<span class="string">&quot;\\.&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="built_in">names</span>(camera2Data),)  <span class="comment">#需转义</span></span><br><span class="line">mytest &lt;- <span class="string">&quot;this_is_a_test&quot;</span></span><br><span class="line">sub(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;&quot;</span>, mytest) <span class="comment">#不需要转义</span></span><br><span class="line">gsub(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;&quot;</span>, mytest)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_sub.png" /></p>
<ul>
<li>base包中函数:</li>
<li>grep()</li>
<li>grepl():返回一列logical</li>
<li>更多正则表达式规则见<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Regular_expression">维基百科</a></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grep(<span class="string">&quot;Alameda&quot;</span>, camera2Data$intersection) <span class="comment"># 4 5 36</span></span><br><span class="line">table(grepl(<span class="string">&quot;Alameda&quot;</span>, camera2Data$intersection))</span><br><span class="line">camera2Data_noAlameda &lt;- camera2Data[!grepl(<span class="string">&quot;Alameda&quot;</span>, camera2Data$intersection),]</span><br><span class="line">grep(<span class="string">&quot;Alameda&quot;</span>, camera2Data$intersection, value = <span class="built_in">T</span>) <span class="comment"># 直接返回值</span></span><br><span class="line"><span class="built_in">length</span>(grep(<span class="string">&quot;JeffStreet&quot;</span>, camera2Data$intersection)) <span class="comment"># 检查是否出现</span></span><br><span class="line"><span class="built_in">length</span>(grep(<span class="string">&#x27;^[12]/2/2007&#x27;</span>, <span class="string">&#x27;22/2/2007&#x27;</span>, value = <span class="built_in">T</span>))</span><br><span class="line"><span class="built_in">length</span>(grep(<span class="string">&#x27;^[12]/2/2007&#x27;</span>, <span class="string">&#x27;2/2/2007&#x27;</span>, value = <span class="built_in">T</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_grep.png" /></p>
<ul>
<li>base包中函数:</li>
<li>nchar()</li>
<li>substr()</li>
<li>paste()</li>
<li>paste0()</li>
<li>stringr包中函数:</li>
<li>str_trim()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(stringr)</span><br><span class="line">nchar(<span class="string">&quot;Jeffery Leek&quot;</span>)</span><br><span class="line">substr(<span class="string">&quot;Jeffery Leek&quot;</span>,<span class="number">1</span>,<span class="number">7</span>)</span><br><span class="line">paste(<span class="string">&quot;Jeffery&quot;</span>,<span class="string">&quot;Leek&quot;</span>) <span class="comment">#自动加上了空格</span></span><br><span class="line">paste0(<span class="string">&quot;Jeffery&quot;</span>,<span class="string">&quot;Leek&quot;</span>) <span class="comment">#不加空格</span></span><br><span class="line">str_trim(<span class="string">&quot;Jeff      &quot;</span>) <span class="comment">#去掉空格</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_stringr.png" /></p>
<h2 id="date">Date</h2>
<ul>
<li>base包中函数:</li>
<li>date()</li>
<li>Sys.Date()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d1 &lt;- date()</span><br><span class="line"><span class="built_in">class</span>(d1)</span><br><span class="line">d2 &lt;- Sys.Date()</span><br><span class="line"><span class="built_in">class</span>(d2)</span><br><span class="line">format(d2, <span class="string">&quot;%a %b %d&quot;</span>)</span><br><span class="line">julian(d2)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_date.png" /></p>
<ul>
<li>lubridate包中函数:</li>
<li>ymd()</li>
<li>ymd_hms()</li>
<li>dmy():返回日期</li>
<li>wday():返回星期</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library(lubridate)</span><br><span class="line">ymd(<span class="string">&quot;20140108&quot;</span>)</span><br><span class="line">mdy(<span class="string">&quot;08/04/2013&quot;</span>)</span><br><span class="line">ymd_hms(<span class="string">&quot;2011-08-03 10:15:03&quot;</span>)</span><br><span class="line">ymd_hms(<span class="string">&quot;2011-08-03 10:15:03&quot;</span>, tz = <span class="string">&quot;Pacific/Auckland&quot;</span>)</span><br><span class="line">x = dmy(<span class="built_in">c</span>(<span class="string">&quot;1jan2013&quot;</span>,<span class="string">&quot;2jan2013&quot;</span>,<span class="string">&quot;31mar2013&quot;</span>,<span class="string">&quot;30jul2013&quot;</span>))</span><br><span class="line">x[<span class="number">1</span>]</span><br><span class="line">wday(x[<span class="number">1</span>])</span><br><span class="line">wday(x[<span class="number">1</span>],label=<span class="built_in">T</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_lubridate.png" /></p>
<hr />
<h1 id="一些强大的技巧">一些强大的技巧</h1>
<h2 id="section">%&gt;%</h2>
<ul>
<li>%&gt;%:管道函数</li>
<li>下面两条代码等价</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">anscombe_tidy &lt;- anscombe %&gt;% mutate(observation = <span class="built_in">seq_len</span>(n()))</span><br><span class="line">anscombe_tidy &lt;- mutate(anscombe,observation = <span class="built_in">seq_len</span>(n()))</span><br></pre></td></tr></table></figure>
<h2 id="parse_number">parse_number()</h2>
<ul>
<li>readr包中函数:</li>
<li>parse_number():获得数字</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">library(readr)</span><br><span class="line">parse_number(<span class="string">&quot;$1000&quot;</span>) <span class="comment"># 1000</span></span><br><span class="line">parse_number(<span class="string">&quot;1,234,567.78&quot;</span>) <span class="comment"># 1234568</span></span><br><span class="line">parse_number(<span class="string">&quot;class5&quot;</span>) <span class="comment"># 5</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_parse_number.png" /></p>
<h2 id="print10">print(10)</h2>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">k &lt;- &#123;<span class="number">10</span>; <span class="number">5</span>; <span class="number">5</span>; <span class="number">88</span>; <span class="number">7</span>&#125;  <span class="comment"># 取最后一个赋值</span></span><br><span class="line">k</span><br><span class="line">k &lt;- &#123;print(<span class="number">10</span>); <span class="number">5</span>&#125;</span><br><span class="line">k</span><br><span class="line">k &lt;- &#123;print(<span class="number">10</span>)&#125;</span><br><span class="line">k</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_print%2810%29.png" /></p>
<h2 id="data.table-package">data.table package</h2>
<ul>
<li>data.table继承于data.frame</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">library(data.table)</span><br><span class="line">DT &lt;- data.table(x = rnorm(<span class="number">9</span>), r = <span class="built_in">rep</span>(<span class="built_in">c</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>),each=<span class="number">3</span>), z = rnorm(<span class="number">9</span>))</span><br><span class="line">head(DT, <span class="number">3</span>)</span><br><span class="line">DT[<span class="built_in">c</span>(<span class="number">2</span>,<span class="number">3</span>)] <span class="comment"># 取2,3行</span></span><br><span class="line">DT[<span class="number">1</span>:<span class="number">2</span>,<span class="built_in">c</span>(<span class="number">2</span>,<span class="number">3</span>)] <span class="comment"># 取2,3列</span></span><br><span class="line">DT[,<span class="built_in">list</span>(mean(x),<span class="built_in">sum</span>(z))] <span class="comment"># 返回x的均值和z的和</span></span><br><span class="line">DT[,table(r)] <span class="comment"># 返回r的分布</span></span><br><span class="line">DT[,w:=&#123;tmp &lt;- (x+z); log2(tmp+<span class="number">5</span>)&#125;] <span class="comment">#增加一列w</span></span><br><span class="line">DT[,a:=x&gt;<span class="number">0</span>] <span class="comment"># 增加一列a</span></span><br><span class="line">DT[,b:=mean(x+w),by=a] <span class="comment"># 增加一列b</span></span><br><span class="line">DT &lt;- data.table(x = sample(<span class="built_in">letters</span>[<span class="number">1</span>:<span class="number">3</span>], <span class="number">1E5</span>, <span class="literal">TRUE</span>))</span><br><span class="line">DT[, .N, by=x]</span><br><span class="line">DT &lt;- data.table(x=<span class="built_in">rep</span>(<span class="built_in">c</span>(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>),each=<span class="number">100</span>),y=rnorm(<span class="number">300</span>))</span><br><span class="line">setkey(DT, x)</span><br><span class="line">head(DT[<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">DT1 &lt;- data.table(x=<span class="built_in">c</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;dt1&#x27;</span>),y=<span class="number">1</span>:<span class="number">4</span>)</span><br><span class="line">DT2 &lt;- data.table(x=<span class="built_in">c</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;dt2&#x27;</span>),z=<span class="number">5</span>:<span class="number">7</span>)</span><br><span class="line">setkey(DT1,x);setkey(DT2,x) <span class="comment"># key不要求唯一</span></span><br><span class="line">DT1</span><br><span class="line">DT2</span><br><span class="line">merge(DT1,DT2) <span class="comment">#合并</span></span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_data.table.png" /></p>
<ul>
<li>fread():读取数据特别快</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(data.table)</span><br><span class="line">big_df &lt;- data.frame(x=rnorm(<span class="number">1E7</span>),y=rnorm(<span class="number">1E7</span>))</span><br><span class="line">file &lt;- tempfile()</span><br><span class="line">write.table(big_df,file=file,row.names=<span class="literal">FALSE</span>,col.names=<span class="literal">TRUE</span>,sep=<span class="string">&quot;\t&quot;</span>,<span class="built_in">quote</span>=<span class="literal">FALSE</span>)</span><br><span class="line">system.time(fread(file))</span><br><span class="line">system.time(read.table(file,header= <span class="literal">TRUE</span>,sep=<span class="string">&quot;\t&quot;</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_fread.png" /></p>
<h2 id="lapplyaspplyapplytapplymapply">lapply,aspply,apply,tapply,mapply</h2>
<ul>
<li>lappy:loop over a list and evaluate a function on each element</li>
<li>sapply:same as lappy but try to simplify the result</li>
<li>apply:apply a function over the margins of any array</li>
<li>tapply:apply a function over subsets of a vector</li>
<li>mapply:multivariate version of lapply</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- 1:<span class="number">4</span></span><br><span class="line">lapply(x, runif)</span><br><span class="line">x &lt;- 1:<span class="number">4</span></span><br><span class="line">sapply(x, runif)</span><br><span class="line">x &lt;- matrix(rnorm(<span class="number">200</span>), <span class="number">20</span>, <span class="number">10</span>)</span><br><span class="line">apply(x, <span class="number">2</span>, mean)</span><br><span class="line">x &lt;- <span class="built_in">c</span>(rnorm(<span class="number">10</span>), runif(<span class="number">10</span>), rnorm(<span class="number">10</span>,<span class="number">1</span>))</span><br><span class="line">f &lt;- gl(<span class="number">3</span>, <span class="number">10</span>)</span><br><span class="line">tapply(x, f, mean)</span><br><span class="line">mapply(<span class="built_in">rep</span>, <span class="number">1</span>:<span class="number">4</span>, <span class="number">1</span>:<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_apply.png" /></p>
<h2 id="now">now()</h2>
<ul>
<li>now():可查看指定城市时间</li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">可查城市</a></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now(<span class="string">&quot;America/New_York&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/pictures/R/R_now.png" /></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/R/" rel="tag"># R</a>
              <a href="/tags/get-data/" rel="tag"># get data</a>
              <a href="/tags/clean-data/" rel="tag"># clean data</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/08/13/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86/" rel="prev" title="统计学习的基本定理">
      <i class="fa fa-chevron-left"></i> 统计学习的基本定理
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/01/24/2017/" rel="next" title="2017">
      2017 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#tips"><span class="nav-number">1.</span> <span class="nav-text">Tips</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#data-collection"><span class="nav-number">2.</span> <span class="nav-text">Data collection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#set-path"><span class="nav-number">2.1.</span> <span class="nav-text">set path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#create-directories"><span class="nav-number">2.2.</span> <span class="nav-text">create directories</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#get-data"><span class="nav-number">2.3.</span> <span class="nav-text">get data</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#from-csv"><span class="nav-number">2.3.1.</span> <span class="nav-text">from csv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-xlsx"><span class="nav-number">2.3.2.</span> <span class="nav-text">from xlsx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-xml"><span class="nav-number">2.3.3.</span> <span class="nav-text">from xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-json"><span class="nav-number">2.3.4.</span> <span class="nav-text">from JSON</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-mysql"><span class="nav-number">2.3.5.</span> <span class="nav-text">from MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-hdf5"><span class="nav-number">2.3.6.</span> <span class="nav-text">from HDF5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-the-web"><span class="nav-number">2.3.7.</span> <span class="nav-text">from The Web</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-api"><span class="nav-number">2.3.8.</span> <span class="nav-text">from API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from-other-sources"><span class="nav-number">2.3.9.</span> <span class="nav-text">from other sources</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#some-data-resources"><span class="nav-number">2.4.</span> <span class="nav-text">Some Data Resources</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#making-data-tidy"><span class="nav-number">3.</span> <span class="nav-text">Making data tidy</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#subsetting-and-sorting"><span class="nav-number">3.1.</span> <span class="nav-text">Subsetting and Sorting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#subsetting"><span class="nav-number">3.1.1.</span> <span class="nav-text">Subsetting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sorting"><span class="nav-number">3.1.2.</span> <span class="nav-text">Sorting</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#summarizing-data"><span class="nav-number">3.2.</span> <span class="nav-text">Summarizing Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#creating-new-variables"><span class="nav-number">3.3.</span> <span class="nav-text">Creating new Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#create-sequences"><span class="nav-number">3.3.1.</span> <span class="nav-text">Create sequences</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#create-binary-variables"><span class="nav-number">3.3.2.</span> <span class="nav-text">Create binary variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#create-categorical-variables"><span class="nav-number">3.3.3.</span> <span class="nav-text">Create categorical variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#common-transforms"><span class="nav-number">3.3.4.</span> <span class="nav-text">Common transforms</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reshaping-data"><span class="nav-number">3.4.</span> <span class="nav-text">Reshaping Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#editing-text-variable"><span class="nav-number">3.5.</span> <span class="nav-text">Editing Text Variable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#date"><span class="nav-number">3.6.</span> <span class="nav-text">Date</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%BC%BA%E5%A4%A7%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="nav-number">4.</span> <span class="nav-text">一些强大的技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#section"><span class="nav-number">4.1.</span> <span class="nav-text">%&gt;%</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parse_number"><span class="nav-number">4.2.</span> <span class="nav-text">parse_number()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#print10"><span class="nav-number">4.3.</span> <span class="nav-text">print(10)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data.table-package"><span class="nav-number">4.4.</span> <span class="nav-text">data.table package</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lapplyaspplyapplytapplymapply"><span class="nav-number">4.5.</span> <span class="nav-text">lapply,aspply,apply,tapply,mapply</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#now"><span class="nav-number">4.6.</span> <span class="nav-text">now()</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">msgsxj</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">69</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/msgsxj" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;msgsxj" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:msgsxj@gmail.com" title="E-Mail → mailto:msgsxj@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">msgsxj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.4.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
